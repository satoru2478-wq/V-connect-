<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#0b0b10">

<title>V CONNECT</title>

<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;800&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<style>
/* ===============================
   PREMIUM VISUAL UPGRADE
   =============================== */

:root {
  --bg-dark: #0b0b10;
  --glass: rgba(255,255,255,0.12);
  --border: rgba(255,255,255,0.18);
  --accent: #e73c7e;
  --ease: cubic-bezier(0.16, 1, 0.3, 1);
}

html, body {
  margin: 0;
  height: 100%;
  background: var(--bg-dark);
  font-family: 'Poppins', sans-serif;
  overflow: hidden;
  color: white;
}

/* Siri-style ambient glow */
body::before,
body::after {
  content: "";
  position: fixed;
  inset: -40%;
  background:
    radial-gradient(circle at 30% 30%, rgba(120,140,255,0.35), transparent 45%),
    radial-gradient(circle at 70% 60%, rgba(255,120,200,0.35), transparent 45%);
  filter: blur(140px);
  animation: floatGlow 40s linear infinite;
  z-index: 0;
}

body::after {
  animation-duration: 60s;
  opacity: 0.6;
}

@keyframes floatGlow {
  0% { transform: translate(0,0) scale(1); }
  50% { transform: translate(-12%,8%) scale(1.1); }
  100% { transform: translate(0,0) scale(1); }
}

/* Glass panels */
.panel {
  position: relative;
  z-index: 10;
  background: var(--glass);
  backdrop-filter: blur(28px);
  -webkit-backdrop-filter: blur(28px);
  border-radius: 28px;
  border: 1px solid var(--border);
  box-shadow: 0 30px 80px rgba(0,0,0,0.45);
  padding: 40px;
  width: 85%;
  max-width: 360px;
  text-align: center;
  animation: panelIn 0.9s var(--ease) forwards;
}

@keyframes panelIn {
  from { opacity: 0; transform: translateY(40px) scale(0.96); }
  to { opacity: 1; transform: translateY(0) scale(1); }
}

.hidden { display:none !important; }

h1 {
  font-family: 'Montserrat', sans-serif;
  font-weight: 800;
  letter-spacing: 1px;
  margin-bottom: 30px;
}

input {
  width: 100%;
  padding: 16px;
  border-radius: 18px;
  border: 1px solid var(--border);
  background: rgba(255,255,255,0.18);
  color: white;
  font-size: 1.4rem;
  text-align: center;
  outline: none;
  margin-bottom: 20px;
  font-weight: 700;
  transition: 0.4s var(--ease);
}
input:focus { background: rgba(255,255,255,0.28); transform: scale(1.03); }

button {
  width: 100%;
  padding: 16px;
  border-radius: 50px;
  border: none;
  background: rgba(255,255,255,0.95);
  color: var(--accent);
  font-weight: 700;
  letter-spacing: 1px;
  transition: 0.35s var(--ease);
  box-shadow: 0 15px 35px rgba(0,0,0,0.35);
}
button:hover { transform: scale(1.04); }
button:active { transform: scale(0.96); }

.btn-cancel {
  background: rgba(255,255,255,0.18);
  color: white;
}

/* Video */
#video-container {
  position: fixed;
  inset: 0;
  z-index: 5;
  display:none;
}

.vid-fullscreen {
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  object-fit:cover;
}

.vid-pip {
  position:absolute;
  bottom:120px;
  right:20px;
  width:120px;
  height:180px;
  border-radius:22px;
  object-fit:cover;
  box-shadow:0 25px 60px rgba(0,0,0,0.6);
  z-index:20;
}

.mirrored { transform: scaleX(-1); }

/* Controls */
#controls {
  position:absolute;
  bottom:40px;
  left:50%;
  transform:translateX(-50%);
  display:flex;
  gap:15px;
  background: rgba(255,255,255,0.18);
  backdrop-filter: blur(20px);
  padding:14px 26px;
  border-radius:50px;
  z-index:50;
  transition:0.6s var(--ease);
}

.controls-hidden {
  transform: translate(-50%,150%);
  opacity:0;
}

.icon-btn {
  width:50px;
  height:50px;
  border-radius:50%;
  border:none;
  background:white;
  color:var(--accent);
  font-size:1.2rem;
}

.btn-red { background:#ff4757; color:white; }

/* Chat */
#chat-container {
  position:absolute;
  bottom:120px;
  left:20px;
  width:300px;
  max-height:400px;
  background: rgba(0,0,0,0.55);
  backdrop-filter: blur(20px);
  border-radius:22px;
  overflow:hidden;
  transform:translateX(-150%);
  transition:0.6s var(--ease);
  z-index:60;
}
#chat-container.visible { transform:translateX(0); }

#messages { padding:15px; flex:1; overflow-y:auto; }

/* Cinematic overlay */
#cinematic-overlay {
  position:fixed;
  inset:0;
  background:
    radial-gradient(circle at center,
      rgba(255,255,255,0.18),
      rgba(0,0,0,0.85) 70%);
  backdrop-filter: blur(20px);
  opacity:0;
  pointer-events:none;
  z-index:999;
  transition:opacity 1.2s cubic-bezier(0.16,1,0.3,1);
}
#cinematic-overlay.active { opacity:1; }
</style>
</head>

<body>

<div id="menu-panel" class="panel">
  <h1>V CONNECT</h1>
  <button onclick="createRoom()">Generate PIN</button>
  <button onclick="showJoin()">Join PIN</button>
</div>

<div id="host-panel" class="panel hidden">
  <p>SECURE PIN</p>
  <div id="pin-display" style="font-size:3.5rem;font-weight:800;">...</div>
</div>

<div id="join-panel" class="panel hidden">
  <p>ENTER PIN</p>
  <input type="number" id="pin-input" placeholder="0000">
  <button onclick="joinRoom()">Connect</button>
  <button class="btn-cancel" onclick="location.reload()">Cancel</button>
</div>

<div id="video-container">
  <video id="remote-video" class="vid-fullscreen" autoplay playsinline></video>
  <video id="local-video" class="vid-pip mirrored" autoplay muted playsinline></video>

  <div id="chat-container">
    <div id="messages"></div>
  </div>

  <div id="controls">
    <button class="icon-btn" onclick="toggleChat()"><i class="fas fa-comment"></i></button>
    <button class="icon-btn" onclick="toggleMic()" id="btn-mic"><i class="fas fa-microphone"></i></button>
    <button class="icon-btn" onclick="toggleCam()" id="btn-cam"><i class="fas fa-video"></i></button>
    <button class="icon-btn btn-red" onclick="location.reload()"><i class="fas fa-phone-slash"></i></button>
  </div>
</div>

<div id="cinematic-overlay"></div>

<script src="/socket.io/socket.io.js"></script>
<script>
/* LOGIC UNCHANGED â€“ CINEMATIC EFFECT ADDED */
const socket = io();
let peerConnection, localStream, remoteStream;
const config = { iceServers: [{ urls: 'stun:stun.l.google.com:19302' }] };

function playCinematicConnect(){
  const o=document.getElementById("cinematic-overlay");
  o.classList.add("active");
  setTimeout(()=>o.classList.remove("active"),900);
}

function createPeerConnection(){
  peerConnection=new RTCPeerConnection(config);
  localStream.getTracks().forEach(t=>peerConnection.addTrack(t,localStream));
  peerConnection.ontrack=e=>{
    remoteStream=e.streams[0];
    document.getElementById("remote-video").srcObject=remoteStream;
  };
  peerConnection.onconnectionstatechange=()=>{
    if(peerConnection.connectionState==="connected"){
      playCinematicConnect();
    }
  };
}
</script>

</body>
</html>