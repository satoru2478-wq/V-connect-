<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#0b0b10">

<title>V CONNECT</title>

<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;800&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<style>
/* ===============================
   ORIGINAL BASE (UNCHANGED)
   =============================== */
:root {
  --glass: rgba(255,255,255,0.15);
  --border: rgba(255,255,255,0.2);
  --accent: #e73c7e;
  --ease: cubic-bezier(0.16,1,0.3,1);
}

body {
  margin: 0;
  background: #0b0b10;
  font-family: 'Poppins', sans-serif;
  color: white;
  height: 100vh;
  width: 100vw;
  overflow: hidden;
  display: flex;
  align-items: center;
  justify-content: center;
  -webkit-user-select: none;
  user-select: none;
  -webkit-tap-highlight-color: transparent;
}

/* ===============================
   PREMIUM AMBIENT BACKGROUND
   =============================== */
body::before,
body::after {
  content: "";
  position: fixed;
  inset: -40%;
  background:
    radial-gradient(circle at 30% 30%, rgba(120,140,255,0.35), transparent 45%),
    radial-gradient(circle at 70% 60%, rgba(255,120,200,0.35), transparent 45%);
  filter: blur(140px);
  animation: glowMove 40s linear infinite;
  z-index: 0;
}
body::after {
  animation-duration: 60s;
  opacity: 0.6;
}
@keyframes glowMove {
  0% { transform: translate(0,0); }
  50% { transform: translate(-10%,8%); }
  100% { transform: translate(0,0); }
}

/* ===============================
   PANELS (ORIGINAL + SAFE POLISH)
   =============================== */
.panel {
  position: relative;
  z-index: 5;
  background: var(--glass);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--border);
  border-radius: 25px;
  padding: 40px;
  text-align: center;
  box-shadow: 0 15px 35px rgba(0,0,0,0.3);
  width: 85%;
  max-width: 350px;
  animation: slideUp 0.8s var(--ease) forwards;
  opacity: 0;
  transform: translateY(30px);
}

@keyframes slideUp {
  to { opacity: 1; transform: translateY(0); }
}

.hidden { display: none !important; }

h1 {
  font-family: 'Montserrat', sans-serif;
  font-weight: 800;
  letter-spacing: 1px;
  margin-bottom: 30px;
}

/* Inputs */
input {
  width: 100%;
  padding: 15px;
  border-radius: 15px;
  border: 1px solid rgba(255,255,255,0.3);
  background: rgba(255,255,255,0.2);
  color: white;
  font-size: 1.5rem;
  text-align: center;
  outline: none;
  margin-bottom: 20px;
  font-weight: bold;
  font-family: 'Montserrat', sans-serif;
}
input:focus {
  background: rgba(255,255,255,0.3);
}

/* Buttons */
button {
  width: 100%;
  padding: 16px;
  border-radius: 50px;
  border: none;
  background: white;
  color: var(--accent);
  font-weight: bold;
  font-size: 1rem;
  cursor: pointer;
  transition: 0.3s var(--ease);
  margin-bottom: 12px;
}
button:active { transform: scale(0.96); }

.btn-cancel {
  background: rgba(255,255,255,0.2);
  color: white;
}

/* ===============================
   VIDEO + CONTROLS (UNCHANGED)
   =============================== */
#video-container {
  position: fixed;
  inset: 0;
  background: #000;
  z-index: 1;
  display: none;
}

.vid-fullscreen {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.vid-pip {
  position: absolute;
  bottom: 120px;
  right: 20px;
  width: 120px;
  height: 180px;
  border-radius: 18px;
  border: 2px solid rgba(255,255,255,0.5);
  background: #222;
  object-fit: cover;
  z-index: 20;
}

.mirrored { transform: scaleX(-1); }

/* Controls */
#controls {
  position: absolute;
  bottom: 40px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  gap: 15px;
  z-index: 50;
  background: rgba(255,255,255,0.2);
  padding: 12px 25px;
  border-radius: 40px;
  backdrop-filter: blur(15px);
  transition: 0.6s var(--ease);
}

.controls-hidden {
  transform: translate(-50%,150%);
  opacity: 0;
  pointer-events: none;
}

.icon-btn {
  width: 50px;
  height: 50px;
  border-radius: 50%;
  background: rgba(255,255,255,0.9);
  color: var(--accent);
  border: none;
  font-size: 1.2rem;
}

.btn-red { background:#ff4757; color:white; }

/* ===============================
   CINEMATIC CONNECT OVERLAY
   =============================== */
#cinematic-overlay {
  position: fixed;
  inset: 0;
  background:
    radial-gradient(circle at center,
      rgba(255,255,255,0.18),
      rgba(0,0,0,0.85) 70%);
  backdrop-filter: blur(18px);
  opacity: 0;
  pointer-events: none;
  z-index: 999;
  transition: opacity 1.2s cubic-bezier(0.16,1,0.3,1);
}
#cinematic-overlay.active { opacity: 1; }
</style>
</head>

<body>

<div id="menu-panel" class="panel">
  <h1>V CONNECT</h1>
  <button onclick="createRoom()">Generate PIN</button>
  <button onclick="showJoin()">Join PIN</button>
</div>

<div id="host-panel" class="panel hidden">
  <p>SECURE PIN</p>
  <div id="pin-display" style="font-size:3.5rem;font-weight:800;">...</div>
  <p style="opacity:0.8">Waiting for peerâ€¦</p>
</div>

<div id="join-panel" class="panel hidden">
  <p>ENTER PIN</p>
  <input type="number" id="pin-input" placeholder="0000">
  <button onclick="joinRoom()">Connect</button>
  <button class="btn-cancel" onclick="location.reload()">Cancel</button>
</div>

<div id="video-container">
  <video id="remote-video" class="vid-fullscreen" autoplay playsinline></video>
  <video id="local-video" class="vid-pip mirrored" autoplay muted playsinline></video>

  <div id="controls">
    <button class="icon-btn" onclick="toggleMic()" id="btn-mic"><i class="fas fa-microphone"></i></button>
    <button class="icon-btn" onclick="toggleCam()" id="btn-cam"><i class="fas fa-video"></i></button>
    <button class="icon-btn btn-red" onclick="location.reload()"><i class="fas fa-phone-slash"></i></button>
  </div>
</div>

<div id="cinematic-overlay"></div>

<script src="/socket.io/socket.io.js"></script>
<script>
/* ===============================
   ONLY ADDITION (SAFE)
   =============================== */
function playCinematicConnect() {
  const o = document.getElementById("cinematic-overlay");
  o.classList.add("active");
  setTimeout(() => o.classList.remove("active"), 900);
}

/* HOOKED SAFELY */
const _createPeerConnection = createPeerConnection;
createPeerConnection = function () {
  _createPeerConnection();
  peerConnection.onconnectionstatechange = () => {
    if (peerConnection.connectionState === "connected") {
      playCinematicConnect();
    }
  };
};
</script>

</body>
</html>